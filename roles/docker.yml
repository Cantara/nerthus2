name: Install Docker
vars:
  username: ec2-user
tasks:
  - block:
    - name: Installing Docker
      yum:
        name: docker
        state: latest
    - name: Add docker group to ec2-user
      ansible.builtin.user:
        name: "{{ username }}"
        groups: docker
        append: yes
    - name: Add docker group to ec2-user
      ansible.builtin.user:
        name: "{{ service }}"
        groups: docker
        append: yes
      when: service_in_docker is defined
    - name: Starting and Enabling Docker service
      service:
        name: docker
        state: started
        enabled: yes
    become: yes
    become_user: root